<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LifeTalk Academy - Interactive Stoic Experience</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1d29 0%, #2d3748 50%, #1a202c 100%);
            color: #f7fafc;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255,215,0,0.3);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logo:hover {
            transform: scale(1.05);
        }
        
        .logo-symbol {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(45deg, #d4af37, #ffd700);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #1a202c;
            font-weight: bold;
            animation: pulse 2s infinite;
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(16, 185, 129, 0.2);
            padding: 8px 15px;
            border-radius: 20px;
            border: 1px solid #10b981;
        }
        
        .live-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: blink 1s infinite;
        }
        
        .container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .scenario-selector {
            background: rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,215,0,0.3);
        }
        
        .scenario-title {
            text-align: center;
            font-size: 2em;
            color: #ffd700;
            margin-bottom: 20px;
        }
        
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .scenario-card {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.1), transparent);
            transition: left 0.5s;
        }
        
        .scenario-card:hover::before {
            left: 100%;
        }
        
        .scenario-card:hover {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255,215,0,0.2);
        }
        
        .scenario-card.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }
        
        .scenario-emoji {
            font-size: 2.5em;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .scenario-name {
            font-size: 1.3em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #ffd700;
        }
        
        .scenario-description {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 15px;
        }
        
        .difficulty-badge {
            background: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 5px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            text-align: center;
        }
        
        .difficulty-medium { background: rgba(255, 187, 36, 0.3); color: #fbbf24; }
        .difficulty-hard { background: rgba(239, 68, 68, 0.3); color: #ef4444; }
        .difficulty-expert { background: rgba(139, 92, 246, 0.3); color: #8b5cf6; }
        
        .conversation-area {
            background: rgba(0,0,0,0.4);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 600px;
            display: none;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .conversation-area.active {
            display: block;
            animation: slideInUp 0.5s ease-out;
        }
        
        .conversation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .character-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #ef4444, #dc2626);
            animation: avatarPulse 3s infinite;
        }
        
        .character-details h3 {
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .character-mood {
            font-size: 0.9em;
            opacity: 0.8;
        }
        
        .stress-meter {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stress-bar {
            width: 100px;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .stress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #fbbf24, #ef4444);
            width: 75%;
            border-radius: 4px;
            transition: width 0.3s;
        }
        
        .conversation-feed {
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.02);
            border-radius: 15px;
        }
        
        .message {
            margin-bottom: 20px;
            animation: messageAppear 0.5s ease-out;
        }
        
        .message-npc {
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .message-player {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            flex-direction: row-reverse;
            margin-left: 50px;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .npc-avatar {
            background: linear-gradient(45deg, #ef4444, #dc2626);
        }
        
        .player-avatar {
            background: linear-gradient(45deg, #3b82f6, #1d4ed8);
        }
        
        .message-content {
            background: rgba(255,255,255,0.1);
            padding: 12px 16px;
            border-radius: 15px;
            max-width: 70%;
            position: relative;
        }
        
        .message-npc .message-content {
            border-bottom-left-radius: 5px;
        }
        
        .message-player .message-content {
            border-bottom-right-radius: 5px;
            background: rgba(59, 130, 246, 0.2);
        }
        
        .message-timestamp {
            font-size: 0.7em;
            opacity: 0.5;
            margin-top: 5px;
        }
        
        .stoic-analysis {
            background: rgba(212,175,55,0.1);
            border-left: 3px solid #d4af37;
            padding: 10px 15px;
            margin-top: 10px;
            border-radius: 5px;
            font-style: italic;
            font-size: 0.9em;
        }
        
        .response-options {
            display: grid;
            gap: 15px;
        }
        
        .response-option {
            background: rgba(255,255,255,0.05);
            border: 2px solid rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .response-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .response-option:hover::before {
            left: 100%;
        }
        
        .response-option:hover {
            border-color: #ffd700;
            transform: translateX(5px);
            background: rgba(255,215,0,0.05);
        }
        
        .response-option.stoic {
            border-color: #d4af37;
            background: rgba(212,175,55,0.1);
        }
        
        .response-option.impulsive {
            border-color: #ef4444;
            background: rgba(239,68,68,0.05);
        }
        
        .response-option.diplomatic {
            border-color: #3b82f6;
            background: rgba(59,130,246,0.05);
        }
        
        .response-text {
            font-size: 1.1em;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .response-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .response-type {
            padding: 3px 8px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .type-stoic { background: rgba(212,175,55,0.3); color: #d4af37; }
        .type-impulsive { background: rgba(239,68,68,0.3); color: #ef4444; }
        .type-diplomatic { background: rgba(59,130,246,0.3); color: #3b82f6; }
        
        .virtue-impact {
            display: flex;
            gap: 5px;
        }
        
        .virtue-meter {
            width: 20px;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
        }
        
        .virtue-meter.positive { background: #10b981; }
        .virtue-meter.negative { background: #ef4444; }
        
        .coaching-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            background: rgba(16, 185, 129, 0.95);
            border-radius: 15px;
            padding: 20px;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            border: 2px solid #10b981;
        }
        
        .coaching-panel.show {
            transform: translateX(0);
        }
        
        .coach-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .coach-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #1a202c;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #10b981;
            font-weight: bold;
        }
        
        .controls {
            position: fixed;
            bottom: 20px;
            left: 20px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
            background: #3b82f6;
        }
        
        .control-btn.recording {
            background: #ef4444;
            animation: pulse 1s infinite;
        }
        
        .progress-tracker {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 250px;
            background: rgba(0,0,0,0.8);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 999;
        }
        
        .virtue-progress {
            margin-bottom: 15px;
        }
        
        .virtue-name {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .virtue-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .virtue-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .wisdom-fill { background: #d4af37; }
        .justice-fill { background: #10b981; }
        .courage-fill { background: #ef4444; }
        .temperance-fill { background: #3b82f6; }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn-start {
            background: linear-gradient(45deg, #d4af37, #ffd700);
            color: #1a202c;
            font-size: 1.2em;
            padding: 15px 30px;
        }
        
        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(212,175,55,0.3);
        }
        
        .notification-system {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1001;
        }
        
        .notification {
            background: rgba(16, 185, 129, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            margin-bottom: 10px;
            transform: translateY(-100px);
            transition: transform 0.3s ease;
            border: 1px solid #10b981;
            max-width: 400px;
            text-align: center;
        }
        
        .notification.show {
            transform: translateY(0);
        }
        
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            opacity: 0.7;
            font-style: italic;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dot {
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background: #ffd700;
            animation: typingBounce 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
        
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        @keyframes avatarPulse {
            0%, 100% { border: 2px solid transparent; }
            50% { border: 2px solid #ffd700; }
        }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }
        
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .container {
                padding: 0 15px;
            }
            
            .scenario-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                padding: 10px 15px;
                flex-direction: column;
                gap: 10px;
            }
            
            .progress-tracker {
                position: relative;
                top: 0;
                right: 0;
                width: 100%;
                margin-bottom: 20px;
            }
            
            .coaching-panel {
                position: relative;
                bottom: 0;
                right: 0;
                width: 100%;
                margin-top: 20px;
                transform: none;
            }
            
            .controls {
                position: relative;
                bottom: 0;
                left: 0;
                justify-content: center;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo" onclick="showWelcome()">
            <div class="logo-symbol">üèõÔ∏è</div>
            <div>
                <div style="font-size: 1.3em; font-weight: bold; color: #ffd700;">LifeTalk Academy</div>
                <div style="font-size: 0.9em; opacity: 0.8;">"Interactive Stoic Communication"</div>
            </div>
        </div>
        <div class="status">
            <div class="live-indicator">
                <div class="live-dot"></div>
                <span>Marcus AI Online</span>
            </div>
            <div style="color: #d4af37;">‚≠ê Virtue Level: Sage-in-Training</div>
        </div>
    </div>

    <div class="container">
        <div class="scenario-selector" id="scenarioSelector">
            <div class="scenario-title">üé≠ Choose Your Challenge</div>
            <div style="text-align: center; margin-bottom: 30px; opacity: 0.9;">
                Select a scenario to practice Stoic communication principles in real-time
            </div>
            
            <div class="scenario-grid">
                <div class="scenario-card" onclick="selectScenario('angry-boss')" data-scenario="angry-boss">
                    <div class="scenario-emoji">üò†</div>
                    <div class="scenario-name">The Furious Manager</div>
                    <div class="scenario-description">Your boss is having a meltdown about the quarterly report. Practice staying virtuous under pressure.</div>
                    <div class="difficulty-badge difficulty-hard">Advanced</div>
                </div>
                
                <div class="scenario-card" onclick="selectScenario('defensive-partner')" data-scenario="defensive-partner">
                    <div class="scenario-emoji">üíî</div>
                    <div class="scenario-name">Defensive Partner</div>
                    <div class="scenario-description">Your partner feels attacked and is getting defensive. Navigate with wisdom and compassion.</div>
                    <div class="difficulty-badge difficulty-medium">Intermediate</div>
                </div>
                
                <div class="scenario-card" onclick="selectScenario('difficult-client')" data-scenario="difficult-client">
                    <div class="scenario-emoji">üìû</div>
                    <div class="scenario-name">Impossible Client</div>
                    <div class="scenario-description">A client is threatening to cancel over a misunderstanding. Practice justice and courage.</div>
                    <div class="difficulty-badge difficulty-expert">Expert</div>
                </div>
                
                <div class="scenario-card" onclick="selectScenario('family-conflict')" data-scenario="family-conflict">
                    <div class="scenario-emoji">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                    <div class="scenario-name">Holiday Family Drama</div>
                    <div class="scenario-description">Family dinner has turned into a political battlefield. Practice temperance and wisdom.</div>
                    <div class="difficulty-badge difficulty-medium">Intermediate</div>
                </div>
            </div>
            
            <div style="text-align: center;">
                <button class="btn btn-start" onclick="startRandomScenario()">üé≤ Surprise Me! (Random Challenge)</button>
            </div>
        </div>

        <div class="conversation-area" id="conversationArea">
            <div class="conversation-header">
                <div class="character-info">
                    <div class="character-avatar" id="characterAvatar">üò†</div>
                    <div class="character-details">
                        <h3 id="characterName">Margaret Sullivan</h3>
                        <div class="character-mood" id="characterMood">Furious about quarterly reports</div>
                    </div>
                </div>
                <div class="stress-meter">
                    <span>Tension:</span>
                    <div class="stress-bar">
                        <div class="stress-fill" id="stressFill"></div>
                    </div>
                    <span id="stressLevel">High</span>
                </div>
            </div>

            <div class="conversation-feed" id="conversationFeed">
                <!-- Messages will be dynamically added here -->
            </div>

            <div class="response-options" id="responseOptions">
                <!-- Response options will be dynamically added here -->
            </div>
        </div>
    </div>

    <!-- Live Coaching Panel -->
    <div class="coaching-panel" id="coachingPanel">
        <div class="coach-header">
            <div class="coach-avatar">M</div>
            <div>
                <div style="font-weight: bold; color: #1a202c;">Marcus (AI Coach)</div>
                <div style="font-size: 0.8em; opacity: 0.8; color: #1a202c;">Live Guidance</div>
            </div>
        </div>
        <div id="coachingMessage" style="color: #1a202c; line-height: 1.4;">
            Remember: Their anger is their choice. Your virtue is yours. Focus only on what you can control.
        </div>
    </div>

    <!-- Audio Controls -->
    <div class="controls">
        <button class="control-btn" id="voiceBtn" onclick="toggleVoiceMode()" title="Voice Practice Mode">
            üé§
        </button>
        <button class="control-btn" onclick="playBgMusic()" title="Stoic Ambient Sounds">
            üéµ
        </button>
        <button class="control-btn" onclick="takeBreath()" title="Stoic Breathing Exercise">
            üßò‚Äç‚ôÇÔ∏è
        </button>
    </div>

    <!-- Progress Tracker -->
    <div class="progress-tracker">
        <div style="text-align: center; font-weight: bold; margin-bottom: 15px; color: #ffd700;">
            üèõÔ∏è Virtue Progress
        </div>
        
        <div class="virtue-progress">
            <div class="virtue-name">
                <span>üéØ Wisdom</span>
                <span id="wisdomScore">73%</span>
            </div>
            <div class="virtue-bar">
                <div class="virtue-fill wisdom-fill" id="wisdomBar" style="width: 73%;"></div>
            </div>
        </div>
        
        <div class="virtue-progress">
            <div class="virtue-name">
                <span>‚öñÔ∏è Justice</span>
                <span id="justiceScore">68%</span>
            </div>
            <div class="virtue-bar">
                <div class="virtue-fill justice-fill" id="justiceBar" style="width: 68%;"></div>
            </div>
        </div>
        
        <div class="virtue-progress">
            <div class="virtue-name">
                <span>üí™ Courage</span>
                <span id="courageScore">81%</span>
            </div>
            <div class="virtue-bar">
                <div class="virtue-fill courage-fill" id="courageBar" style="width: 81%;"></div>
            </div>
        </div>
        
        <div class="virtue-progress">
            <div class="virtue-name">
                <span>üßò‚Äç‚ôÇÔ∏è Temperance</span>
                <span id="temperanceScore">76%</span>
            </div>
            <div class="virtue-bar">
                <div class="virtue-fill temperance-fill" id="temperanceBar" style="width: 76%;"></div>
            </div>
        </div>
    </div>

    <!-- Notification System -->
    <div class="notification-system" id="notificationSystem">
        <!-- Notifications will appear here -->
    </div>

    <script>
        // Global state
        let currentScenario = null;
        let conversationStep = 0;
        let virtueScores = { wisdom: 73, justice: 68, courage: 81, temperance: 76 };
        let isVoiceMode = false;
        let stressLevel = 75;
        
        // Scenario data with branching dialogue
        const scenarios = {
            'angry-boss': {
                character: { name: 'Margaret Sullivan', mood: 'Furious about quarterly reports', avatar: 'üò†', stressColor: '#ef4444' },
                opening: "What is THIS supposed to be?! The board meeting is in 30 minutes and this report is completely useless! Have you even been paying attention to the numbers?",
                responses: [
                    {
                        text: "I understand you're under pressure. Let me explain what happened with the data.",
                        type: 'stoic',
                        virtue: { wisdom: 5, temperance: 3 },
                        reaction: "Margaret pauses, slightly surprised by your calm response...",
                        nextMessage: "Well... at least you're not making excuses. But we still have a major problem here."
                    },
                    {
                        text: "It's not my fault! Finance gave me the wrong numbers and Sarah was sick all week.",
                        type: 'impulsive',
                        virtue: { wisdom: -3, justice: -2 },
                        reaction: "Margaret's face gets redder...",
                        nextMessage: "I don't want to hear excuses! I want solutions! This is exactly the kind of attitude that's been destroying this department!"
                    },
                    {
                        text: "You're right to be concerned. What specific changes do you need for the board meeting?",
                        type: 'diplomatic',
                        virtue: { wisdom: 2, justice: 4 },
                        reaction: "Margaret takes a breath, focusing on the immediate problem...",
                        nextMessage: "Finally, someone who wants to solve problems instead of create them. Here's what we need to fix..."
                    }
                ]
            },
            'defensive-partner': {
                character: { name: 'Alex Chen', mood: 'Feeling attacked and misunderstood', avatar: 'üíî', stressColor: '#fbbf24' },
                opening: "You always do this! Every time I try to share my feelings, you turn it into a lecture about what I'm doing wrong. I can't talk to you anymore!",
                responses: [
                    {
                        text: "You're right - I haven't been listening well. Help me understand what you're feeling.",
                        type: 'stoic',
                        virtue: { wisdom: 4, temperance: 5 },
                        reaction: "Alex's defensive posture softens slightly...",
                        nextMessage: "I... I just feel like nothing I do is ever good enough for you. And when I try to explain, you shut me down."
                    },
                    {
                        text: "I don't lecture you! I'm just trying to help you see the situation clearly.",
                        type: 'impulsive',
                        virtue: { wisdom: -4, temperance: -3 },
                        reaction: "Alex crosses arms and looks away...",
                        nextMessage: "See?! You're doing it again! This is exactly what I'm talking about. You can't even hear yourself."
                    },
                    {
                        text: "I can see this is really important to you. Can we start over? I want to hear you.",
                        type: 'diplomatic',
                        virtue: { wisdom: 3, justice: 3 },
                        reaction: "Alex hesitates, then sits down...",
                        nextMessage: "I need to feel heard, not fixed. Sometimes I just want you to understand, not solve everything."
                    }
                ]
            },
            'difficult-client': {
                character: { name: 'Robert Khan', mood: 'Threatening to cancel contract', avatar: 'üìû', stressColor: '#ef4444' },
                opening: "This is absolutely unacceptable! We're paying you premium rates and getting amateur results. I'm considering terminating our contract immediately!",
                responses: [
                    {
                        text: "I understand your frustration. Let's focus on resolving the specific issues you've identified.",
                        type: 'stoic',
                        virtue: { courage: 4, temperance: 3 },
                        reaction: "Robert's tone becomes slightly less aggressive...",
                        nextMessage: "Fine. But I want to see immediate action, not more promises. Here's what needs to be fixed..."
                    },
                    {
                        text: "Hold on! We've delivered exactly what was in the contract. You can't just change the requirements now.",
                        type: 'impulsive',
                        virtue: { courage: -2, justice: -4 },
                        reaction: "Robert's voice rises even higher...",
                        nextMessage: "Don't you dare tell me what I can't do! I'm the client here, and clearly you don't understand what customer service means!"
                    },
                    {
                        text: "I value our partnership. Can we schedule a call to review the project scope and address your concerns?",
                        type: 'diplomatic',
                        virtue: { justice: 3, wisdom: 2 },
                        reaction: "Robert pauses to consider...",
                        nextMessage: "Alright. But this better not be another waste of time. I want concrete solutions, not corporate speak."
                    }
                ]
            },
            'family-conflict': {
                character: { name: 'Uncle Bob', mood: 'Ranting about politics at dinner', avatar: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶', stressColor: '#fbbf24' },
                opening: "I can't believe what this country has become! People today have no respect for traditional values. Back in my day, we knew right from wrong!",
                responses: [
                    {
                        text: "I can see you feel strongly about this. Family dinner might not be the best place for this discussion though.",
                        type: 'stoic',
                        virtue: { temperance: 5, wisdom: 3 },
                        reaction: "Uncle Bob looks surprised by your calm response...",
                        nextMessage: "Well... I suppose you have a point. I just get worked up sometimes. Pass the potatoes?"
                    },
                    {
                        text: "That's completely wrong! You're living in the past and refusing to see how the world has changed for the better.",
                        type: 'impulsive',
                        virtue: { temperance: -4, wisdom: -3 },
                        reaction: "Uncle Bob's face turns red as the family tension rises...",
                        nextMessage: "I knew it! Your generation has been completely brainwashed! No wonder this family can't have a decent conversation anymore!"
                    },
                    {
                        text: "Different generations certainly see things differently. What values do you think are most important for our family?",
                        type: 'diplomatic',
                        virtue: { wisdom: 4, justice: 2 },
                        reaction: "Uncle Bob softens, focusing on family instead of politics...",
                        nextMessage: "Well... I suppose respect and loyalty matter most. Maybe we can agree on that, regardless of everything else."
                    }
                ]
            }
        };
        
        const stoicQuotes = [
            "You have power over your mind - not outside events. Realize this, and you will find strength.",
            "It's not what happens to you, but how you react to it that matters.",
            "The best revenge is not to be like your enemy.",
            "Today I escaped anxiety. Or no, I discarded it, because it was within me.",
            "How much trouble he avoids who does not look to see what his neighbor says or does.",
            "Every new beginning comes from some other beginning's end."
        ];
        
        // Interactive functions
        function selectScenario(scenarioId) {
            // Clear previous selections
            document.querySelectorAll('.scenario-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select current scenario
            const selectedCard = document.querySelector(`[data-scenario="${scenarioId}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
            
            // Start scenario after brief delay
            setTimeout(() => {
                startScenario(scenarioId);
            }, 500);
        }
        
        function startRandomScenario() {
            const scenarioIds = Object.keys(scenarios);
            const randomId = scenarioIds[Math.floor(Math.random() * scenarioIds.length)];
            selectScenario(randomId);
        }
        
        function startScenario(scenarioId) {
            currentScenario = scenarios[scenarioId];
            conversationStep = 0;
            
            // Hide scenario selector and show conversation
            document.getElementById('scenarioSelector').style.display = 'none';
            document.getElementById('conversationArea').classList.add('active');
            
            // Set up character
            const avatar = document.getElementById('characterAvatar');
            const name = document.getElementById('characterName');
            const mood = document.getElementById('characterMood');
            
            if (avatar) avatar.textContent = currentScenario.character.avatar;
            if (name) name.textContent = currentScenario.character.name;
            if (mood) mood.textContent = currentScenario.character.mood;
            
            // Clear conversation feed
            const feed = document.getElementById('conversationFeed');
            if (feed) feed.innerHTML = '';
            
            // Show live coaching
            const coaching = document.getElementById('coachingPanel');
            if (coaching) coaching.classList.add('show');
            updateCoaching("Take a deep breath. Remember: you can only control your response, not their reaction. Practice virtue.");
            
            // Start conversation with typing indicator
            showTypingIndicator();
            setTimeout(() => {
                addMessage(currentScenario.opening, 'npc');
                showResponseOptions();
            }, 2000);
            
            showNotification("üèõÔ∏è Practice session started! Remember your Stoic principles.");
        }
        
        function showTypingIndicator() {
            const feed = document.getElementById('conversationFeed');
            if (!feed || !currentScenario) return;
            
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message message-npc';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="message-avatar npc-avatar">${currentScenario.character.avatar}</div>
                <div class="typing-indicator">
                    <span>${currentScenario.character.name} is typing</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            feed.appendChild(typingDiv);
            feed.scrollTop = feed.scrollHeight;
        }
        
        function removeTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }
        
        function addMessage(text, sender, analysis = null) {
            removeTypingIndicator();
            
            const feed = document.getElementById('conversationFeed');
            if (!feed) return;
            
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${sender}`;
            
            const avatar = sender === 'npc' ? 
                `<div class="message-avatar npc-avatar">${currentScenario ? currentScenario.character.avatar : 'ü§ñ'}</div>` :
                `<div class="message-avatar player-avatar">You</div>`;
            
            const analysisHtml = analysis ? `<div class="stoic-analysis">üèõÔ∏è ${analysis}</div>` : '';
            
            messageDiv.innerHTML = `
                ${avatar}
                <div class="message-content">
                    ${text}
                    <div class="message-timestamp">${new Date().toLocaleTimeString()}</div>
                    ${analysisHtml}
                </div>
            `;
            
            feed.appendChild(messageDiv);
            feed.scrollTop = feed.scrollHeight;
        }
        
        function showResponseOptions() {
            const optionsContainer = document.getElementById('responseOptions');
            if (!optionsContainer || !currentScenario) return;
            
            optionsContainer.innerHTML = '';
            
            currentScenario.responses.forEach((response, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = `response-option ${response.type}`;
                optionDiv.onclick = () => selectResponse(index);
                
                const virtueIcons = Object.entries(response.virtue).map(([virtue, change]) => 
                    `<div class="virtue-meter ${change > 0 ? 'positive' : 'negative'}"></div>`
                ).join('');
                
                optionDiv.innerHTML = `
                    <div class="response-text">${response.text}</div>
                    <div class="response-meta">
                        <div class="response-type type-${response.type}">
                            ${response.type.charAt(0).toUpperCase() + response.type.slice(1)}
                        </div>
                        <div class="virtue-impact">
                            ${virtueIcons}
                        </div>
                    </div>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });
        }
        
        function selectResponse(index) {
            if (!currentScenario || !currentScenario.responses[index]) return;
            
            const response = currentScenario.responses[index];
            
            // Add player message
            addMessage(response.text, 'player', getStoicAnalysis(response));
            
            // Update virtue scores
            updateVirtueScores(response.virtue);
            
            // Update stress level based on response
            updateStressLevel(response.type);
            
            // Update coaching
            updateCoaching(getCoachingAdvice(response));
            
            // Clear response options temporarily
            const optionsContainer = document.getElementById('responseOptions');
            if (optionsContainer) optionsContainer.innerHTML = '';
            
            // Show typing indicator for NPC response
            setTimeout(() => {
                showTypingIndicator();
                setTimeout(() => {
                    addMessage(response.nextMessage, 'npc');
                    
                    // Continue conversation or end
                    if (conversationStep < 2) {
                        conversationStep++;
                        setTimeout(showResponseOptions, 1000);
                    } else {
                        endConversation();
                    }
                }, 2000);
            }, 1000);
        }
        
        function getStoicAnalysis(response) {
            const analyses = {
                stoic: [
                    "Excellent! You demonstrated virtue by staying calm and focusing on what you can control.",
                    "Marcus Aurelius would approve - you responded with wisdom rather than emotion.",
                    "Perfect application of Stoic principles - acknowledging their humanity while maintaining your virtue."
                ],
                impulsive: [
                    "Notice how this response came from emotion rather than virtue. A Stoic would pause first.",
                    "This reaction makes the situation about you rather than seeking understanding.",
                    "Remember Epictetus: 'It's not what happens to you, but how you react to it.'"
                ],
                diplomatic: [
                    "Good balance of assertiveness and understanding - a practical application of virtue.",
                    "You found middle ground while maintaining your principles.",
                    "Seneca would appreciate this measured response that seeks mutual benefit."
                ]
            };
            
            const typeAnalyses = analyses[response.type];
            return typeAnalyses[Math.floor(Math.random() * typeAnalyses.length)];
        }
        
        function updateVirtueScores(changes) {
            Object.entries(changes).forEach(([virtue, change]) => {
                virtueScores[virtue] = Math.max(0, Math.min(100, virtueScores[virtue] + change));
                
                // Update progress bars
                const bar = document.getElementById(`${virtue}Bar`);
                const score = document.getElementById(`${virtue}Score`);
                
                if (bar) bar.style.width = `${virtueScores[virtue]}%`;
                if (score) score.textContent = `${virtueScores[virtue]}%`;
            });
            
            // Show virtue change notification
            const changedVirtues = Object.entries(changes).map(([virtue, change]) => 
                `${virtue.charAt(0).toUpperCase() + virtue.slice(1)} ${change > 0 ? '+' : ''}${change}`
            ).join(', ');
            
            showNotification(`üèõÔ∏è Virtue Update: ${changedVirtues}`);
        }
        
        function updateStressLevel(responseType) {
            const stressChanges = {
                stoic: -15,
                diplomatic: -10,
                impulsive: 20
            };
            
            stressLevel = Math.max(0, Math.min(100, stressLevel + stressChanges[responseType]));
            const stressFill = document.getElementById('stressFill');
            const stressLevelElement = document.getElementById('stressLevel');
            
            if (stressFill) stressFill.style.width = `${stressLevel}%`;
            
            if (stressLevelElement) {
                const stressLabels = ['Very Low', 'Low', 'Medium', 'High', 'Very High'];
                const labelIndex = Math.floor(stressLevel / 20);
                stressLevelElement.textContent = stressLabels[labelIndex];
            }
        }
        
        function getCoachingAdvice(response) {
            const advice = {
                stoic: [
                    "Excellent virtue practice! You're embodying Stoic principles beautifully.",
                    "Perfect demonstration of emotional regulation. Marcus Aurelius would be proud.",
                    "You're growing stronger by choosing virtue over reaction."
                ],
                impulsive: [
                    "Notice that impulse? Next time, pause and ask: 'What would virtue look like here?'",
                    "Remember: their behavior is their choice. Your virtue is your choice.",
                    "Try the Stoic pause: breathe, think 'What can I control?' then respond."
                ],
                diplomatic: [
                    "Good balance! You're learning to be assertive while remaining virtuous.",
                    "Nice work finding common ground without compromising your principles.",
                    "You're developing practical wisdom - applying philosophy to real situations."
                ]
            };
            
            const typeAdvice = advice[response.type];
            return typeAdvice[Math.floor(Math.random() * typeAdvice.length)];
        }
        
        function updateCoaching(message) {
            const coachingMessage = document.getElementById('coachingMessage');
            if (coachingMessage) {
                coachingMessage.textContent = message;
            }
        }
        
        function endConversation() {
            setTimeout(() => {
                const totalScore = Object.values(virtueScores).reduce((a, b) => a + b, 0) / 4;
                let endingMessage = '';
                
                if (totalScore >= 80) {
                    endingMessage = "üèõÔ∏è Exceptional! You demonstrated true Stoic mastery. Your virtue transformed this difficult conversation.";
                } else if (totalScore >= 70) {
                    endingMessage = "‚≠ê Well done! You applied Stoic principles effectively. Notice how virtue improved the outcome.";
                } else {
                    endingMessage = "üí™ Good practice! Every difficult conversation is an opportunity to grow in virtue. Try again?";
                }
                
                addMessage(endingMessage, 'npc');
                
                // Add restart option
                setTimeout(() => {
                    const conversationArea = document.getElementById('conversationArea');
                    if (conversationArea) {
                        const restartDiv = document.createElement('div');
                        restartDiv.innerHTML = `
                            <div style="text-align: center; margin-top: 30px;">
                                <button class="btn btn-start" onclick="restartPractice()">
                                    üé≠ Practice Another Scenario
                                </button>
                                <button class="btn" onclick="showReflection()" style="background: rgba(212,175,55,0.3); color: #d4af37; margin-left: 15px;">
                                    ü™û Reflect on This Experience
                                </button>
                            </div>
                        `;
                        conversationArea.appendChild(restartDiv);
                    }
                }, 2000);
                
            }, 1000);
        }
        
        function restartPractice() {
            const conversationArea = document.getElementById('conversationArea');
            const scenarioSelector = document.getElementById('scenarioSelector');
            const coachingPanel = document.getElementById('coachingPanel');
            
            if (conversationArea) conversationArea.classList.remove('active');
            if (scenarioSelector) scenarioSelector.style.display = 'block';
            if (coachingPanel) coachingPanel.classList.remove('show');
            
            // Clear any extra elements
            const extras = document.querySelectorAll('#conversationArea > div:not(.conversation-header):not(.conversation-feed):not(.response-options)');
            extras.forEach(el => el.remove());
        }
        
        function showReflection() {
            showNotification("ü™û Stoic Reflection: What did you learn about yourself? What virtue will you practice next?");
        }
        
        function toggleVoiceMode() {
            isVoiceMode = !isVoiceMode;
            const btn = document.getElementById('voiceBtn');
            
            if (btn) {
                if (isVoiceMode) {
                    btn.classList.add('recording');
                    btn.textContent = '‚èπÔ∏è';
                    showNotification("üé§ Voice mode active! Speak your responses naturally.");
                } else {
                    btn.classList.remove('recording');
                    btn.textContent = 'üé§';
                    showNotification("üé§ Voice mode disabled. Back to text responses.");
                }
            }
        }
        
        function playBgMusic() {
            showNotification("üéµ Playing Stoic meditation sounds to enhance focus...");
        }
        
        function takeBreath() {
            showNotification("üßò‚Äç‚ôÇÔ∏è Breathe in for 4... hold for 7... out for 8... 'You have power over your mind.'");
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            
            const notificationSystem = document.getElementById('notificationSystem');
            if (notificationSystem) {
                notificationSystem.appendChild(notification);
                
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);
                
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.remove();
                        }
                    }, 300);
                }, 4000);
            }
        }
        
        function showWelcome() {
            showNotification("üèõÔ∏è Welcome to LifeTalk Academy! Practice ancient wisdom in modern conversations.");
        }
        
        // Initialize with random Stoic wisdom
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                const randomQuote = stoicQuotes[Math.floor(Math.random() * stoicQuotes.length)];
                showNotification(`üí≠ Stoic Wisdom: "${randomQuote}"`);
            }, 2000);
            
            // Simulate live updates
            setInterval(() => {
                if (Math.random() < 0.3) {
                    const updates = [
                        "üåü Sarah just completed her difficult family conversation!",
                        "üìà Your virtue scores are in the top 15% globally!",
                        "üèõÔ∏è Daily challenge: Practice one Stoic principle today.",
                        "üí™ You're on a 5-day Stoic practice streak!",
                        "üë• Join the live community discussion at 7 PM EST."
                    ];
                    const randomUpdate = updates[Math.floor(Math.random() * updates.length)];
                    showNotification(randomUpdate);
                }
            }, 15000);
        });
    </script>
</body>
</html>
